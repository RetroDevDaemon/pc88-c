<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PC88-C: PC88-C (0.1.2)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PC88-C
   &#160;<span id="projectnumber">0.1.21</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PC88-C (0.1.2) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>A very minimal framework for PC88 development using C. <br  />
 <code>src/pc88-c.h</code> has all the good stuff. <br  />
 Check out the <code>src/lib/</code> folder for the detailed code. Everything should be laid bare.<br  />
 <br  />
 For source code for the Linux port of xdisk2 check here:<br  />
 <a href="https://github.com/bferguson3/xdisk3">https://github.com/bferguson3/xdisk3</a><br  />
 <br  />
 Consider joining the RetroDev Discord to discuss, ask questions, and contribute:<br  />
 <a href="https://discord.gg/Js3uUrc">https://discord.gg/Js3uUrc</a> <br  />
 </p>
<h2><a class="anchor" id="autotoc_md2"></a>
To-Dos</h2>
<p>-V2 ALU optimizations<br  />
 -OPN/A FM<br  />
 -Joystick<br  />
 -Disk saving<br  />
 -Kanji ROM, nado<br  />
 <br  />
 </p>
<h2><a class="anchor" id="autotoc_md3"></a>
Documentation</h2>
<p>Doxygen:<br  />
 <a href="https://bferguson3.github.io/pc88-c/">https://bferguson3.github.io/pc88-c/</a><br  />
 (Tutorial, of out of date):<br  />
 Manual part 1, overview: <a href="https://barelyconsciousgames.blogspot.com/2021/02/pc-88-c-framework-for-nec-pc8801.html">https://barelyconsciousgames.blogspot.com/2021/02/pc-88-c-framework-for-nec-pc8801.html</a> <br  />
 Manual part 2, basic drawing: <a href="https://barelyconsciousgames.blogspot.com/2021/02/pc88-c-frame-for-nec-pc-8801-part-2.html">https://barelyconsciousgames.blogspot.com/2021/02/pc88-c-frame-for-nec-pc-8801-part-2.html</a> <br  />
</p>
<h2><a class="anchor" id="autotoc_md4"></a>
What's new</h2>
<p>0.1.2<br  />
</p><ul>
<li>Added Disk BASIC support to the d88 tool, and static makefile.<br  />
</li>
</ul>
<p>Example: <code>$ make -f Makefile.n88 PROJECT=examples/helloworld-static</code><br  />
 Then, write the disk using xdisk, and on the PC88:<br  />
 </p><div class="fragment"><div class="line">bload&quot;2:main.bin</div>
<div class="line">def usr1=&amp;he123</div>
<div class="line">a=usr1(0)</div>
</div><!-- fragment --><p> Where main.bin is the output file existing on disk drive 2,<br  />
 and $e123 is the resultant address of _main(), taken from <code>out/main.map</code>.<br  />
 Ensure that code, data and stack locations are properly set! Double check the makefile.<br  />
</p><ul>
<li>Refactored SSG player properly.<br  />
 <hr  />
</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
Important: requires SDCC to be on the path&lt;br&gt;</h2>
<p>If you have SDCC 4.1.0 and Python3, you should be able to build without issue.<br  />
 (I use the latest build of SDCC to ensure I have the fewest issues.)<br  />
 Recommended emulators:<br  />
 M88x5 - Cycle accurate, excellent for debugging, slow (get from Illusion City, below)<br  />
 XM8 - SDL2, fast, no debugging (<a href="http://retropc.net/pi/xm8/index.html">http://retropc.net/pi/xm8/index.html</a>) <br  />
 Illusion City, huge tools list, recent M88 builds: <a href="https://illusioncity.net/nec-pc-88-series-emulators-tools-lists/">https://illusioncity.net/nec-pc-88-series-emulators-tools-lists/</a> <br  />
 quasi88 - SDL1, builds on pretty much any nix (<a href="https://github.com/waitingmoon/quasi88/tree/master">https://github.com/waitingmoon/quasi88/tree/master</a>)<br  />
 <br  />
 Brief overview:<br  />
 <br  />
 Python dependencies for tools:<br  />
 </p><div class="fragment"><div class="line">$ python3 -m pip install --upgrade Pillow</div>
<div class="line">$ pip (or pip3) install numpy</div>
<div class="line">$ pip (or pip3) install intelhex</div>
</div><!-- fragment --><p><code>Makefile</code> - Creates app.d88 for use in an emulator.<br  />
 Usage: <code>make PROJECT=examples/1bitsprite USEDSEC=0x2f</code><br  />
 Creates app.d88 in root of '1bitsprite' project and overrides the value of the initial number of sectors to copy in from the autoloader to 2Fh.<br  />
 You can also do <code>make IPL</code> to recompile src/ipl.z80 and src/disk.z80.<br  />
 <br  />
 <code>ipl.bin</code> is the autoloader.<br  />
 In some ways it takes place of crt0. For me, src/crt0.c instead sets up the PC88-C environment. Notably, the putchr/print functions are probably quite clumsy since I haven't written them for a system before. <br  />
 Important byte locations in IPL.BIN:<br  />
 <code>0x2F : Number of sectors loaded by autoloader (bytes / 256, default: 0x5F)</code><br  />
 <code>0x34-0x35 : Stack pointer location (Default: 00 01 (=$0100))</code><br  />
 <code>0x38-0x39 : Code start location (Default: 00 10 (=$1000))</code><br  />
 (SDCC <em>data</em> is set to 0x0100~).<br  />
 PC-8x usually has the stack on page 0 (0x0000 to 0x00ff).<br  />
 The stack pointer is initially set in IPL.BIN to 0x0100.<br  />
 <code>disk.z80</code> is a disk I/O driver under 256 bytes.(!!)<br  />
 <br  />
 maked88.py is a special tool (replaces D88SAVER.EXE) to make/add the files to<br  />
 a 2D PC-88 disk image.<br  />
 <code>0 0 1</code> must be the IPL, <code>0 0 2</code> must be the the file to load into RAM.<br  />
 I tried to make it as easy as possible to adjust memory addresses and load options.<br  />
 <br  />
 The disk will auto boot!<br  />
</p>
<p>A hello world minimal main.c looks like:<br  />
 </p><div class="fragment"><div class="line">#include &quot;pc88-c.h&quot;</div>
<div class="line"> </div>
<div class="line">void main() { </div>
<div class="line">    print(&quot;Hello World!\x00&quot;);</div>
<div class="line">    while(1) { }</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
<br  />
 A large amount of information is in <code>pc88-c.h</code> <br  />
</p>
<h2><a class="anchor" id="autotoc_md6"></a>
On Pi4/00</h2>
<p>Use the sdcc-compile-guide.txt to compile SDCC for your Pi.<br  />
 If properly made/installed, the normal make command should work :)<br  />
 <br  />
</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Revision history</h2>
<p>0.1.1<br  />
 -Added minimal SSG support for MUCOM88 compiled files!<br  />
 CURRENT SUPPORT:<br  />
 Channels D, E, F (SSG) on octaves 2 through 6<br  />
 Supported MML: </p><div class="fragment"><div class="line">Tone and rest control (a-g, ., r, &gt;, &lt;)</div>
<div class="line">o, t, v, [, ], P, w, #</div>
</div><!-- fragment --><p> Octave, tempo, volume, repeat, SSG mixer control, noise frequency, flag byte.<br  />
 (Technically @ is supported but does nothing.)<br  />
 To use the player, simply include the <b>compiled</b> song anywhere in code<br  />
 and use the LoadSong() function to load the song data into predefined structs, then<br  />
 PlaySong() every vertical blank to play it.<br  />
<br  />
 -Some small bugfixes and optimizations.<br  />
 <br  />
 0.1.0<br  />
 -Added clock-irq example<br  />
 -Added bin2c.py (converts binary to .h)<br  />
 -Added xbas.c<br  />
 xbas.c should compile on pretty much any nix.<br  />
 It allows you to transfer BASIC programs to PC-88 over USB-Serial.<br  />
 Stay tuned for disk writing, ROM extraction, etc.!<br  />
 <br  />
 0.0.14b<br  />
 -Fixed SetCursorPos (wasn't updating ROWPOINTER)<br  />
 -Added VERY BASIC math routines<br  />
 -Added CMDFLAGS to the <code>make</code> for your own build flags. <br  />
 e.g. <code>make PROJECT=examples/hachinoid USEDSEC=0x49 CMDFLAGS=--cyclomatic</code><br  />
 -Moved stack pointer back to 0x100 (doubled stack size)<br  />
 <br  />
 0.0.14<br  />
 -Fixed EraseVRAMArea - deleted old code fragments<br  />
 -Still WIP Hachinoid example<br  />
 -Added BEEP support<br  />
 0.0.13b<br  />
 -Added IPL target to makefile (<code>make IPL</code>). No longer requires ASW, compiles with SDCC.<br  />
 -Updated png288.py. If you append <code>-rle</code>, <code>/rle</code> etc. it will RLE-encode the file with the following schema:<br  />
 </p><div class="fragment"><div class="line">0x80 [X] [Y] : Duplicate [X] by [Y] times.</div>
<div class="line">All other bytes : Copy through</div>
</div><!-- fragment --><p> -Added getsjis.py. Scans and prints a file for N88-BASIC kana. <br  />
 -Added Sprite, XYPos structs to lib header<br  />
 -WIP: Arkanoid clone example<br  />
 0.0.12<br  />
 -Made a real Makefile and removed the .bat/.sh files.<br  />
 0.0.11 <br  />
 -Fixed maked88.py. Was not copying in the last byte of the file causing build issues.<br  />
 -Various tweaks and fixes<br  />
 <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
